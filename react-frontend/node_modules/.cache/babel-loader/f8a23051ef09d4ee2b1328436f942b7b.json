{"ast":null,"code":"/* eslint no-undefined: 0 */\n'use strict';\n\nconst MimeNode = require('../mime-node');\n\nconst mimeFuncs = require('../mime-funcs');\n/**\n * Creates the object for composing a MimeNode instance out from the mail options\n *\n * @constructor\n * @param {Object} mail Mail options\n */\n\n\nclass MailComposer {\n  constructor(mail) {\n    this.mail = mail || {};\n    this.message = false;\n  }\n  /**\n   * Builds MimeNode instance\n   */\n\n\n  compile() {\n    this._alternatives = this.getAlternatives();\n    this._htmlNode = this._alternatives.filter(alternative => /^text\\/html\\b/i.test(alternative.contentType)).pop();\n    this._attachments = this.getAttachments(!!this._htmlNode);\n    this._useRelated = !!(this._htmlNode && this._attachments.related.length);\n    this._useAlternative = this._alternatives.length > 1;\n    this._useMixed = this._attachments.attached.length > 1 || this._alternatives.length && this._attachments.attached.length === 1; // Compose MIME tree\n\n    if (this.mail.raw) {\n      this.message = new MimeNode().setRaw(this.mail.raw);\n    } else if (this._useMixed) {\n      this.message = this._createMixed();\n    } else if (this._useAlternative) {\n      this.message = this._createAlternative();\n    } else if (this._useRelated) {\n      this.message = this._createRelated();\n    } else {\n      this.message = this._createContentNode(false, [].concat(this._alternatives || []).concat(this._attachments.attached || []).shift() || {\n        contentType: 'text/plain',\n        content: ''\n      });\n    } // Add custom headers\n\n\n    if (this.mail.headers) {\n      this.message.addHeader(this.mail.headers);\n    } // Add headers to the root node, always overrides custom headers\n\n\n    ['from', 'sender', 'to', 'cc', 'bcc', 'reply-to', 'in-reply-to', 'references', 'subject', 'message-id', 'date'].forEach(header => {\n      let key = header.replace(/-(\\w)/g, (o, c) => c.toUpperCase());\n\n      if (this.mail[key]) {\n        this.message.setHeader(header, this.mail[key]);\n      }\n    }); // Sets custom envelope\n\n    if (this.mail.envelope) {\n      this.message.setEnvelope(this.mail.envelope);\n    } // ensure Message-Id value\n\n\n    this.message.messageId();\n    return this.message;\n  }\n  /**\n   * List all attachments. Resulting attachment objects can be used as input for MimeNode nodes\n   *\n   * @param {Boolean} findRelated If true separate related attachments from attached ones\n   * @returns {Object} An object of arrays (`related` and `attached`)\n   */\n\n\n  getAttachments(findRelated) {\n    let icalEvent, eventObject;\n    let attachments = [].concat(this.mail.attachments || []).map((attachment, i) => {\n      let data;\n      let isMessageNode = /^message\\//i.test(attachment.contentType);\n\n      if (/^data:/i.test(attachment.path || attachment.href)) {\n        attachment = this._processDataUrl(attachment);\n      }\n\n      data = {\n        contentType: attachment.contentType || mimeFuncs.detectMimeType(attachment.filename || attachment.path || attachment.href || 'bin'),\n        contentDisposition: attachment.contentDisposition || (isMessageNode ? 'inline' : 'attachment'),\n        contentTransferEncoding: 'contentTransferEncoding' in attachment ? attachment.contentTransferEncoding : 'base64'\n      };\n\n      if (attachment.filename) {\n        data.filename = attachment.filename;\n      } else if (!isMessageNode && attachment.filename !== false) {\n        data.filename = (attachment.path || attachment.href || '').split('/').pop().split('?').shift() || 'attachment-' + (i + 1);\n\n        if (data.filename.indexOf('.') < 0) {\n          data.filename += '.' + mimeFuncs.detectExtension(data.contentType);\n        }\n      }\n\n      if (/^https?:\\/\\//i.test(attachment.path)) {\n        attachment.href = attachment.path;\n        attachment.path = undefined;\n      }\n\n      if (attachment.cid) {\n        data.cid = attachment.cid;\n      }\n\n      if (attachment.raw) {\n        data.raw = attachment.raw;\n      } else if (attachment.path) {\n        data.content = {\n          path: attachment.path\n        };\n      } else if (attachment.href) {\n        data.content = {\n          href: attachment.href\n        };\n      } else {\n        data.content = attachment.content || '';\n      }\n\n      if (attachment.encoding) {\n        data.encoding = attachment.encoding;\n      }\n\n      if (attachment.headers) {\n        data.headers = attachment.headers;\n      }\n\n      return data;\n    });\n\n    if (this.mail.icalEvent) {\n      if (typeof this.mail.icalEvent === 'object' && (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent.href || this.mail.icalEvent.raw)) {\n        icalEvent = this.mail.icalEvent;\n      } else {\n        icalEvent = {\n          content: this.mail.icalEvent\n        };\n      }\n\n      eventObject = {};\n      Object.keys(icalEvent).forEach(key => {\n        eventObject[key] = icalEvent[key];\n      });\n      eventObject.contentType = 'application/ics';\n\n      if (!eventObject.headers) {\n        eventObject.headers = {};\n      }\n\n      eventObject.filename = eventObject.filename || 'invite.ics';\n      eventObject.headers['Content-Disposition'] = 'attachment';\n      eventObject.headers['Content-Transfer-Encoding'] = 'base64';\n    }\n\n    if (!findRelated) {\n      return {\n        attached: attachments.concat(eventObject || []),\n        related: []\n      };\n    } else {\n      return {\n        attached: attachments.filter(attachment => !attachment.cid).concat(eventObject || []),\n        related: attachments.filter(attachment => !!attachment.cid)\n      };\n    }\n  }\n  /**\n   * List alternatives. Resulting objects can be used as input for MimeNode nodes\n   *\n   * @returns {Array} An array of alternative elements. Includes the `text` and `html` values as well\n   */\n\n\n  getAlternatives() {\n    let alternatives = [],\n        text,\n        html,\n        watchHtml,\n        icalEvent,\n        eventObject;\n\n    if (this.mail.text) {\n      if (typeof this.mail.text === 'object' && (this.mail.text.content || this.mail.text.path || this.mail.text.href || this.mail.text.raw)) {\n        text = this.mail.text;\n      } else {\n        text = {\n          content: this.mail.text\n        };\n      }\n\n      text.contentType = 'text/plain' + (!text.encoding && mimeFuncs.isPlainText(text.content) ? '' : '; charset=utf-8');\n    }\n\n    if (this.mail.watchHtml) {\n      if (typeof this.mail.watchHtml === 'object' && (this.mail.watchHtml.content || this.mail.watchHtml.path || this.mail.watchHtml.href || this.mail.watchHtml.raw)) {\n        watchHtml = this.mail.watchHtml;\n      } else {\n        watchHtml = {\n          content: this.mail.watchHtml\n        };\n      }\n\n      watchHtml.contentType = 'text/watch-html' + (!watchHtml.encoding && mimeFuncs.isPlainText(watchHtml.content) ? '' : '; charset=utf-8');\n    } // only include the calendar alternative if there are no attachments\n    // otherwise you might end up in a blank screen on some clients\n\n\n    if (this.mail.icalEvent && !(this.mail.attachments && this.mail.attachments.length)) {\n      if (typeof this.mail.icalEvent === 'object' && (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent.href || this.mail.icalEvent.raw)) {\n        icalEvent = this.mail.icalEvent;\n      } else {\n        icalEvent = {\n          content: this.mail.icalEvent\n        };\n      }\n\n      eventObject = {};\n      Object.keys(icalEvent).forEach(key => {\n        eventObject[key] = icalEvent[key];\n      });\n\n      if (eventObject.content && typeof eventObject.content === 'object') {\n        // we are going to have the same attachment twice, so mark this to be\n        // resolved just once\n        eventObject.content._resolve = true;\n      }\n\n      eventObject.filename = false;\n      eventObject.contentType = 'text/calendar; charset=\"utf-8\"; method=' + (eventObject.method || 'PUBLISH').toString().trim().toUpperCase();\n\n      if (!eventObject.headers) {\n        eventObject.headers = {};\n      }\n    }\n\n    if (this.mail.html) {\n      if (typeof this.mail.html === 'object' && (this.mail.html.content || this.mail.html.path || this.mail.html.href || this.mail.html.raw)) {\n        html = this.mail.html;\n      } else {\n        html = {\n          content: this.mail.html\n        };\n      }\n\n      html.contentType = 'text/html' + (!html.encoding && mimeFuncs.isPlainText(html.content) ? '' : '; charset=utf-8');\n    }\n\n    [].concat(text || []).concat(watchHtml || []).concat(html || []).concat(eventObject || []).concat(this.mail.alternatives || []).forEach(alternative => {\n      let data;\n\n      if (/^data:/i.test(alternative.path || alternative.href)) {\n        alternative = this._processDataUrl(alternative);\n      }\n\n      data = {\n        contentType: alternative.contentType || mimeFuncs.detectMimeType(alternative.filename || alternative.path || alternative.href || 'txt'),\n        contentTransferEncoding: alternative.contentTransferEncoding\n      };\n\n      if (alternative.filename) {\n        data.filename = alternative.filename;\n      }\n\n      if (/^https?:\\/\\//i.test(alternative.path)) {\n        alternative.href = alternative.path;\n        alternative.path = undefined;\n      }\n\n      if (alternative.raw) {\n        data.raw = alternative.raw;\n      } else if (alternative.path) {\n        data.content = {\n          path: alternative.path\n        };\n      } else if (alternative.href) {\n        data.content = {\n          href: alternative.href\n        };\n      } else {\n        data.content = alternative.content || '';\n      }\n\n      if (alternative.encoding) {\n        data.encoding = alternative.encoding;\n      }\n\n      if (alternative.headers) {\n        data.headers = alternative.headers;\n      }\n\n      alternatives.push(data);\n    });\n    return alternatives;\n  }\n  /**\n   * Builds multipart/mixed node. It should always contain different type of elements on the same level\n   * eg. text + attachments\n   *\n   * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n   * @returns {Object} MimeNode node element\n   */\n\n\n  _createMixed(parentNode) {\n    let node;\n\n    if (!parentNode) {\n      node = new MimeNode('multipart/mixed', {\n        baseBoundary: this.mail.baseBoundary,\n        textEncoding: this.mail.textEncoding,\n        boundaryPrefix: this.mail.boundaryPrefix,\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    } else {\n      node = parentNode.createChild('multipart/mixed', {\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    }\n\n    if (this._useAlternative) {\n      this._createAlternative(node);\n    } else if (this._useRelated) {\n      this._createRelated(node);\n    }\n\n    [].concat(!this._useAlternative && this._alternatives || []).concat(this._attachments.attached || []).forEach(element => {\n      // if the element is a html node from related subpart then ignore it\n      if (!this._useRelated || element !== this._htmlNode) {\n        this._createContentNode(node, element);\n      }\n    });\n    return node;\n  }\n  /**\n   * Builds multipart/alternative node. It should always contain same type of elements on the same level\n   * eg. text + html view of the same data\n   *\n   * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n   * @returns {Object} MimeNode node element\n   */\n\n\n  _createAlternative(parentNode) {\n    let node;\n\n    if (!parentNode) {\n      node = new MimeNode('multipart/alternative', {\n        baseBoundary: this.mail.baseBoundary,\n        textEncoding: this.mail.textEncoding,\n        boundaryPrefix: this.mail.boundaryPrefix,\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    } else {\n      node = parentNode.createChild('multipart/alternative', {\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    }\n\n    this._alternatives.forEach(alternative => {\n      if (this._useRelated && this._htmlNode === alternative) {\n        this._createRelated(node);\n      } else {\n        this._createContentNode(node, alternative);\n      }\n    });\n\n    return node;\n  }\n  /**\n   * Builds multipart/related node. It should always contain html node with related attachments\n   *\n   * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n   * @returns {Object} MimeNode node element\n   */\n\n\n  _createRelated(parentNode) {\n    let node;\n\n    if (!parentNode) {\n      node = new MimeNode('multipart/related; type=\"text/html\"', {\n        baseBoundary: this.mail.baseBoundary,\n        textEncoding: this.mail.textEncoding,\n        boundaryPrefix: this.mail.boundaryPrefix,\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    } else {\n      node = parentNode.createChild('multipart/related; type=\"text/html\"', {\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    }\n\n    this._createContentNode(node, this._htmlNode);\n\n    this._attachments.related.forEach(alternative => this._createContentNode(node, alternative));\n\n    return node;\n  }\n  /**\n   * Creates a regular node with contents\n   *\n   * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n   * @param {Object} element Node data\n   * @returns {Object} MimeNode node element\n   */\n\n\n  _createContentNode(parentNode, element) {\n    element = element || {};\n    element.content = element.content || '';\n    let node;\n    let encoding = (element.encoding || 'utf8').toString().toLowerCase().replace(/[-_\\s]/g, '');\n\n    if (!parentNode) {\n      node = new MimeNode(element.contentType, {\n        filename: element.filename,\n        baseBoundary: this.mail.baseBoundary,\n        textEncoding: this.mail.textEncoding,\n        boundaryPrefix: this.mail.boundaryPrefix,\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess\n      });\n    } else {\n      node = parentNode.createChild(element.contentType, {\n        filename: element.filename,\n        disableUrlAccess: this.mail.disableUrlAccess,\n        disableFileAccess: this.mail.disableFileAccess,\n        normalizeHeaderKey: this.mail.normalizeHeaderKey\n      });\n    } // add custom headers\n\n\n    if (element.headers) {\n      node.addHeader(element.headers);\n    }\n\n    if (element.cid) {\n      node.setHeader('Content-Id', '<' + element.cid.replace(/[<>]/g, '') + '>');\n    }\n\n    if (element.contentTransferEncoding) {\n      node.setHeader('Content-Transfer-Encoding', element.contentTransferEncoding);\n    } else if (this.mail.encoding && /^text\\//i.test(element.contentType)) {\n      node.setHeader('Content-Transfer-Encoding', this.mail.encoding);\n    }\n\n    if (!/^text\\//i.test(element.contentType) || element.contentDisposition) {\n      node.setHeader('Content-Disposition', element.contentDisposition || (element.cid ? 'inline' : 'attachment'));\n    }\n\n    if (typeof element.content === 'string' && !['utf8', 'usascii', 'ascii'].includes(encoding)) {\n      element.content = Buffer.from(element.content, encoding);\n    } // prefer pregenerated raw content\n\n\n    if (element.raw) {\n      node.setRaw(element.raw);\n    } else {\n      node.setContent(element.content);\n    }\n\n    return node;\n  }\n  /**\n   * Parses data uri and converts it to a Buffer\n   *\n   * @param {Object} element Content element\n   * @return {Object} Parsed element\n   */\n\n\n  _processDataUrl(element) {\n    let parts = (element.path || element.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);\n\n    if (!parts) {\n      return element;\n    }\n\n    element.content = /\\bbase64$/i.test(parts[1]) ? Buffer.from(parts[2], 'base64') : Buffer.from(decodeURIComponent(parts[2]));\n\n    if ('path' in element) {\n      element.path = false;\n    }\n\n    if ('href' in element) {\n      element.href = false;\n    }\n\n    parts[1].split(';').forEach(item => {\n      if (/^\\w+\\/[^/]+$/i.test(item)) {\n        element.contentType = element.contentType || item.toLowerCase();\n      }\n    });\n    return element;\n  }\n\n}\n\nmodule.exports = MailComposer;","map":{"version":3,"names":["MimeNode","require","mimeFuncs","MailComposer","constructor","mail","message","compile","_alternatives","getAlternatives","_htmlNode","filter","alternative","test","contentType","pop","_attachments","getAttachments","_useRelated","related","length","_useAlternative","_useMixed","attached","raw","setRaw","_createMixed","_createAlternative","_createRelated","_createContentNode","concat","shift","content","headers","addHeader","forEach","header","key","replace","o","c","toUpperCase","setHeader","envelope","setEnvelope","messageId","findRelated","icalEvent","eventObject","attachments","map","attachment","i","data","isMessageNode","path","href","_processDataUrl","detectMimeType","filename","contentDisposition","contentTransferEncoding","split","indexOf","detectExtension","undefined","cid","encoding","Object","keys","alternatives","text","html","watchHtml","isPlainText","_resolve","method","toString","trim","push","parentNode","node","baseBoundary","textEncoding","boundaryPrefix","disableUrlAccess","disableFileAccess","normalizeHeaderKey","createChild","element","toLowerCase","includes","Buffer","from","setContent","parts","match","decodeURIComponent","item","module","exports"],"sources":["/home/bijen/Desktop/LaravelReact/react-frontend/node_modules/nodemailer/lib/mail-composer/index.js"],"sourcesContent":["/* eslint no-undefined: 0 */\n\n'use strict';\n\nconst MimeNode = require('../mime-node');\nconst mimeFuncs = require('../mime-funcs');\n\n/**\n * Creates the object for composing a MimeNode instance out from the mail options\n *\n * @constructor\n * @param {Object} mail Mail options\n */\nclass MailComposer {\n    constructor(mail) {\n        this.mail = mail || {};\n        this.message = false;\n    }\n\n    /**\n     * Builds MimeNode instance\n     */\n    compile() {\n        this._alternatives = this.getAlternatives();\n        this._htmlNode = this._alternatives.filter(alternative => /^text\\/html\\b/i.test(alternative.contentType)).pop();\n        this._attachments = this.getAttachments(!!this._htmlNode);\n\n        this._useRelated = !!(this._htmlNode && this._attachments.related.length);\n        this._useAlternative = this._alternatives.length > 1;\n        this._useMixed = this._attachments.attached.length > 1 || (this._alternatives.length && this._attachments.attached.length === 1);\n\n        // Compose MIME tree\n        if (this.mail.raw) {\n            this.message = new MimeNode().setRaw(this.mail.raw);\n        } else if (this._useMixed) {\n            this.message = this._createMixed();\n        } else if (this._useAlternative) {\n            this.message = this._createAlternative();\n        } else if (this._useRelated) {\n            this.message = this._createRelated();\n        } else {\n            this.message = this._createContentNode(\n                false,\n                []\n                    .concat(this._alternatives || [])\n                    .concat(this._attachments.attached || [])\n                    .shift() || {\n                    contentType: 'text/plain',\n                    content: ''\n                }\n            );\n        }\n\n        // Add custom headers\n        if (this.mail.headers) {\n            this.message.addHeader(this.mail.headers);\n        }\n\n        // Add headers to the root node, always overrides custom headers\n        ['from', 'sender', 'to', 'cc', 'bcc', 'reply-to', 'in-reply-to', 'references', 'subject', 'message-id', 'date'].forEach(header => {\n            let key = header.replace(/-(\\w)/g, (o, c) => c.toUpperCase());\n            if (this.mail[key]) {\n                this.message.setHeader(header, this.mail[key]);\n            }\n        });\n\n        // Sets custom envelope\n        if (this.mail.envelope) {\n            this.message.setEnvelope(this.mail.envelope);\n        }\n\n        // ensure Message-Id value\n        this.message.messageId();\n\n        return this.message;\n    }\n\n    /**\n     * List all attachments. Resulting attachment objects can be used as input for MimeNode nodes\n     *\n     * @param {Boolean} findRelated If true separate related attachments from attached ones\n     * @returns {Object} An object of arrays (`related` and `attached`)\n     */\n    getAttachments(findRelated) {\n        let icalEvent, eventObject;\n        let attachments = [].concat(this.mail.attachments || []).map((attachment, i) => {\n            let data;\n            let isMessageNode = /^message\\//i.test(attachment.contentType);\n\n            if (/^data:/i.test(attachment.path || attachment.href)) {\n                attachment = this._processDataUrl(attachment);\n            }\n\n            data = {\n                contentType: attachment.contentType || mimeFuncs.detectMimeType(attachment.filename || attachment.path || attachment.href || 'bin'),\n                contentDisposition: attachment.contentDisposition || (isMessageNode ? 'inline' : 'attachment'),\n                contentTransferEncoding: 'contentTransferEncoding' in attachment ? attachment.contentTransferEncoding : 'base64'\n            };\n\n            if (attachment.filename) {\n                data.filename = attachment.filename;\n            } else if (!isMessageNode && attachment.filename !== false) {\n                data.filename =\n                    (attachment.path || attachment.href || '')\n                        .split('/')\n                        .pop()\n                        .split('?')\n                        .shift() || 'attachment-' + (i + 1);\n                if (data.filename.indexOf('.') < 0) {\n                    data.filename += '.' + mimeFuncs.detectExtension(data.contentType);\n                }\n            }\n\n            if (/^https?:\\/\\//i.test(attachment.path)) {\n                attachment.href = attachment.path;\n                attachment.path = undefined;\n            }\n\n            if (attachment.cid) {\n                data.cid = attachment.cid;\n            }\n\n            if (attachment.raw) {\n                data.raw = attachment.raw;\n            } else if (attachment.path) {\n                data.content = {\n                    path: attachment.path\n                };\n            } else if (attachment.href) {\n                data.content = {\n                    href: attachment.href\n                };\n            } else {\n                data.content = attachment.content || '';\n            }\n\n            if (attachment.encoding) {\n                data.encoding = attachment.encoding;\n            }\n\n            if (attachment.headers) {\n                data.headers = attachment.headers;\n            }\n\n            return data;\n        });\n\n        if (this.mail.icalEvent) {\n            if (\n                typeof this.mail.icalEvent === 'object' &&\n                (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent.href || this.mail.icalEvent.raw)\n            ) {\n                icalEvent = this.mail.icalEvent;\n            } else {\n                icalEvent = {\n                    content: this.mail.icalEvent\n                };\n            }\n\n            eventObject = {};\n            Object.keys(icalEvent).forEach(key => {\n                eventObject[key] = icalEvent[key];\n            });\n\n            eventObject.contentType = 'application/ics';\n            if (!eventObject.headers) {\n                eventObject.headers = {};\n            }\n            eventObject.filename = eventObject.filename || 'invite.ics';\n            eventObject.headers['Content-Disposition'] = 'attachment';\n            eventObject.headers['Content-Transfer-Encoding'] = 'base64';\n        }\n\n        if (!findRelated) {\n            return {\n                attached: attachments.concat(eventObject || []),\n                related: []\n            };\n        } else {\n            return {\n                attached: attachments.filter(attachment => !attachment.cid).concat(eventObject || []),\n                related: attachments.filter(attachment => !!attachment.cid)\n            };\n        }\n    }\n\n    /**\n     * List alternatives. Resulting objects can be used as input for MimeNode nodes\n     *\n     * @returns {Array} An array of alternative elements. Includes the `text` and `html` values as well\n     */\n    getAlternatives() {\n        let alternatives = [],\n            text,\n            html,\n            watchHtml,\n            icalEvent,\n            eventObject;\n\n        if (this.mail.text) {\n            if (typeof this.mail.text === 'object' && (this.mail.text.content || this.mail.text.path || this.mail.text.href || this.mail.text.raw)) {\n                text = this.mail.text;\n            } else {\n                text = {\n                    content: this.mail.text\n                };\n            }\n            text.contentType = 'text/plain' + (!text.encoding && mimeFuncs.isPlainText(text.content) ? '' : '; charset=utf-8');\n        }\n\n        if (this.mail.watchHtml) {\n            if (\n                typeof this.mail.watchHtml === 'object' &&\n                (this.mail.watchHtml.content || this.mail.watchHtml.path || this.mail.watchHtml.href || this.mail.watchHtml.raw)\n            ) {\n                watchHtml = this.mail.watchHtml;\n            } else {\n                watchHtml = {\n                    content: this.mail.watchHtml\n                };\n            }\n            watchHtml.contentType = 'text/watch-html' + (!watchHtml.encoding && mimeFuncs.isPlainText(watchHtml.content) ? '' : '; charset=utf-8');\n        }\n\n        // only include the calendar alternative if there are no attachments\n        // otherwise you might end up in a blank screen on some clients\n        if (this.mail.icalEvent && !(this.mail.attachments && this.mail.attachments.length)) {\n            if (\n                typeof this.mail.icalEvent === 'object' &&\n                (this.mail.icalEvent.content || this.mail.icalEvent.path || this.mail.icalEvent.href || this.mail.icalEvent.raw)\n            ) {\n                icalEvent = this.mail.icalEvent;\n            } else {\n                icalEvent = {\n                    content: this.mail.icalEvent\n                };\n            }\n\n            eventObject = {};\n            Object.keys(icalEvent).forEach(key => {\n                eventObject[key] = icalEvent[key];\n            });\n\n            if (eventObject.content && typeof eventObject.content === 'object') {\n                // we are going to have the same attachment twice, so mark this to be\n                // resolved just once\n                eventObject.content._resolve = true;\n            }\n\n            eventObject.filename = false;\n            eventObject.contentType =\n                'text/calendar; charset=\"utf-8\"; method=' +\n                (eventObject.method || 'PUBLISH')\n                    .toString()\n                    .trim()\n                    .toUpperCase();\n            if (!eventObject.headers) {\n                eventObject.headers = {};\n            }\n        }\n\n        if (this.mail.html) {\n            if (typeof this.mail.html === 'object' && (this.mail.html.content || this.mail.html.path || this.mail.html.href || this.mail.html.raw)) {\n                html = this.mail.html;\n            } else {\n                html = {\n                    content: this.mail.html\n                };\n            }\n            html.contentType = 'text/html' + (!html.encoding && mimeFuncs.isPlainText(html.content) ? '' : '; charset=utf-8');\n        }\n\n        []\n            .concat(text || [])\n            .concat(watchHtml || [])\n            .concat(html || [])\n            .concat(eventObject || [])\n            .concat(this.mail.alternatives || [])\n            .forEach(alternative => {\n                let data;\n\n                if (/^data:/i.test(alternative.path || alternative.href)) {\n                    alternative = this._processDataUrl(alternative);\n                }\n\n                data = {\n                    contentType: alternative.contentType || mimeFuncs.detectMimeType(alternative.filename || alternative.path || alternative.href || 'txt'),\n                    contentTransferEncoding: alternative.contentTransferEncoding\n                };\n\n                if (alternative.filename) {\n                    data.filename = alternative.filename;\n                }\n\n                if (/^https?:\\/\\//i.test(alternative.path)) {\n                    alternative.href = alternative.path;\n                    alternative.path = undefined;\n                }\n\n                if (alternative.raw) {\n                    data.raw = alternative.raw;\n                } else if (alternative.path) {\n                    data.content = {\n                        path: alternative.path\n                    };\n                } else if (alternative.href) {\n                    data.content = {\n                        href: alternative.href\n                    };\n                } else {\n                    data.content = alternative.content || '';\n                }\n\n                if (alternative.encoding) {\n                    data.encoding = alternative.encoding;\n                }\n\n                if (alternative.headers) {\n                    data.headers = alternative.headers;\n                }\n\n                alternatives.push(data);\n            });\n\n        return alternatives;\n    }\n\n    /**\n     * Builds multipart/mixed node. It should always contain different type of elements on the same level\n     * eg. text + attachments\n     *\n     * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n     * @returns {Object} MimeNode node element\n     */\n    _createMixed(parentNode) {\n        let node;\n\n        if (!parentNode) {\n            node = new MimeNode('multipart/mixed', {\n                baseBoundary: this.mail.baseBoundary,\n                textEncoding: this.mail.textEncoding,\n                boundaryPrefix: this.mail.boundaryPrefix,\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        } else {\n            node = parentNode.createChild('multipart/mixed', {\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        }\n\n        if (this._useAlternative) {\n            this._createAlternative(node);\n        } else if (this._useRelated) {\n            this._createRelated(node);\n        }\n\n        []\n            .concat((!this._useAlternative && this._alternatives) || [])\n            .concat(this._attachments.attached || [])\n            .forEach(element => {\n                // if the element is a html node from related subpart then ignore it\n                if (!this._useRelated || element !== this._htmlNode) {\n                    this._createContentNode(node, element);\n                }\n            });\n\n        return node;\n    }\n\n    /**\n     * Builds multipart/alternative node. It should always contain same type of elements on the same level\n     * eg. text + html view of the same data\n     *\n     * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n     * @returns {Object} MimeNode node element\n     */\n    _createAlternative(parentNode) {\n        let node;\n\n        if (!parentNode) {\n            node = new MimeNode('multipart/alternative', {\n                baseBoundary: this.mail.baseBoundary,\n                textEncoding: this.mail.textEncoding,\n                boundaryPrefix: this.mail.boundaryPrefix,\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        } else {\n            node = parentNode.createChild('multipart/alternative', {\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        }\n\n        this._alternatives.forEach(alternative => {\n            if (this._useRelated && this._htmlNode === alternative) {\n                this._createRelated(node);\n            } else {\n                this._createContentNode(node, alternative);\n            }\n        });\n\n        return node;\n    }\n\n    /**\n     * Builds multipart/related node. It should always contain html node with related attachments\n     *\n     * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n     * @returns {Object} MimeNode node element\n     */\n    _createRelated(parentNode) {\n        let node;\n\n        if (!parentNode) {\n            node = new MimeNode('multipart/related; type=\"text/html\"', {\n                baseBoundary: this.mail.baseBoundary,\n                textEncoding: this.mail.textEncoding,\n                boundaryPrefix: this.mail.boundaryPrefix,\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        } else {\n            node = parentNode.createChild('multipart/related; type=\"text/html\"', {\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        }\n\n        this._createContentNode(node, this._htmlNode);\n\n        this._attachments.related.forEach(alternative => this._createContentNode(node, alternative));\n\n        return node;\n    }\n\n    /**\n     * Creates a regular node with contents\n     *\n     * @param {Object} parentNode Parent for this note. If it does not exist, a root node is created\n     * @param {Object} element Node data\n     * @returns {Object} MimeNode node element\n     */\n    _createContentNode(parentNode, element) {\n        element = element || {};\n        element.content = element.content || '';\n\n        let node;\n        let encoding = (element.encoding || 'utf8')\n            .toString()\n            .toLowerCase()\n            .replace(/[-_\\s]/g, '');\n\n        if (!parentNode) {\n            node = new MimeNode(element.contentType, {\n                filename: element.filename,\n                baseBoundary: this.mail.baseBoundary,\n                textEncoding: this.mail.textEncoding,\n                boundaryPrefix: this.mail.boundaryPrefix,\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess\n            });\n        } else {\n            node = parentNode.createChild(element.contentType, {\n                filename: element.filename,\n                disableUrlAccess: this.mail.disableUrlAccess,\n                disableFileAccess: this.mail.disableFileAccess,\n                normalizeHeaderKey: this.mail.normalizeHeaderKey\n            });\n        }\n\n        // add custom headers\n        if (element.headers) {\n            node.addHeader(element.headers);\n        }\n\n        if (element.cid) {\n            node.setHeader('Content-Id', '<' + element.cid.replace(/[<>]/g, '') + '>');\n        }\n\n        if (element.contentTransferEncoding) {\n            node.setHeader('Content-Transfer-Encoding', element.contentTransferEncoding);\n        } else if (this.mail.encoding && /^text\\//i.test(element.contentType)) {\n            node.setHeader('Content-Transfer-Encoding', this.mail.encoding);\n        }\n\n        if (!/^text\\//i.test(element.contentType) || element.contentDisposition) {\n            node.setHeader('Content-Disposition', element.contentDisposition || (element.cid ? 'inline' : 'attachment'));\n        }\n\n        if (typeof element.content === 'string' && !['utf8', 'usascii', 'ascii'].includes(encoding)) {\n            element.content = Buffer.from(element.content, encoding);\n        }\n\n        // prefer pregenerated raw content\n        if (element.raw) {\n            node.setRaw(element.raw);\n        } else {\n            node.setContent(element.content);\n        }\n\n        return node;\n    }\n\n    /**\n     * Parses data uri and converts it to a Buffer\n     *\n     * @param {Object} element Content element\n     * @return {Object} Parsed element\n     */\n    _processDataUrl(element) {\n        let parts = (element.path || element.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);\n        if (!parts) {\n            return element;\n        }\n\n        element.content = /\\bbase64$/i.test(parts[1]) ? Buffer.from(parts[2], 'base64') : Buffer.from(decodeURIComponent(parts[2]));\n\n        if ('path' in element) {\n            element.path = false;\n        }\n\n        if ('href' in element) {\n            element.href = false;\n        }\n\n        parts[1].split(';').forEach(item => {\n            if (/^\\w+\\/[^/]+$/i.test(item)) {\n                element.contentType = element.contentType || item.toLowerCase();\n            }\n        });\n\n        return element;\n    }\n}\n\nmodule.exports = MailComposer;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}